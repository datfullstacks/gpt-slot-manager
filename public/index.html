<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GPT Slot Manager - Admin Account Management</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <!-- Login/Register Section -->
      <div id="authSection" class="auth-section">
        <div class="auth-container">
          <div class="auth-tabs">
            <button class="tab-btn active" onclick="showLogin()">
              ÄÄƒng Nháº­p
            </button>
            <button class="tab-btn" onclick="showRegister()">ÄÄƒng KÃ½</button>
          </div>

          <!-- Login Form -->
          <div id="loginForm" class="auth-form">
            <h2>ÄÄƒng Nháº­p</h2>
            <form onsubmit="handleLogin(event)">
              <div class="form-group">
                <label>Username hoáº·c Email</label>
                <input
                  type="text"
                  id="loginUsername"
                  required
                  placeholder="Nháº­p username hoáº·c email"
                />
              </div>
              <div class="form-group">
                <label>Password</label>
                <input
                  type="password"
                  id="loginPassword"
                  required
                  placeholder="Nháº­p máº­t kháº©u"
                />
              </div>
              <button type="submit" class="btn btn-primary">ÄÄƒng Nháº­p</button>
            </form>
          </div>

          <!-- Register Form -->
          <div id="registerForm" class="auth-form" style="display: none">
            <h2>ÄÄƒng KÃ½ TÃ i Khoáº£n</h2>
            <form onsubmit="handleRegister(event)">
              <div class="form-group">
                <label>Username</label>
                <input
                  type="text"
                  id="registerUsername"
                  required
                  placeholder="Tá»‘i thiá»ƒu 3 kÃ½ tá»±"
                />
              </div>
              <div class="form-group">
                <label>Email</label>
                <input
                  type="email"
                  id="registerEmail"
                  required
                  placeholder="email@example.com"
                />
              </div>
              <div class="form-group">
                <label>Password</label>
                <input
                  type="password"
                  id="registerPassword"
                  required
                  placeholder="Tá»‘i thiá»ƒu 6 kÃ½ tá»±"
                />
              </div>
              <div class="form-group">
                <label>XÃ¡c nháº­n Password</label>
                <input
                  type="password"
                  id="registerPasswordConfirm"
                  required
                  placeholder="Nháº­p láº¡i máº­t kháº©u"
                />
              </div>
              <button type="submit" class="btn btn-primary">ÄÄƒng KÃ½</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Dashboard Section -->
      <div
        id="dashboardSection"
        class="dashboard-section"
        style="display: none"
      >
        <!-- Header -->
        <div class="dashboard-header">
          <div class="user-info">
            <h2>ğŸ‘‹ Xin chÃ o, <span id="username"></span></h2>
            <p>Email: <span id="userEmail"></span></p>
          </div>
          <button onclick="handleLogout()" class="btn btn-danger">
            ÄÄƒng Xuáº¥t
          </button>
        </div>

        <!-- Code Verification Section -->
        <div id="codeVerificationSection" class="card" style="display: none">
          <h3>ğŸ” XÃ¡c Thá»±c MÃ£ Truy Cáº­p</h3>
          <div
            style="
              background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
              padding: 15px;
              border-radius: 8px;
              margin-bottom: 15px;
              border-left: 4px solid #3b82f6;
            "
          >
            <p
              style="
                margin: 0 0 10px 0;
                color: #1e40af;
                font-size: 14px;
                font-weight: bold;
              "
            >
              ğŸ“‹ CÃ¡ch láº¥y mÃ£ truy cáº­p:
            </p>
            <ol
              style="
                margin: 0;
                padding-left: 20px;
                color: #1e3a8a;
                font-size: 13px;
              "
            >
              <li>MÃ£ truy cáº­p 16 kÃ½ tá»± Ä‘Ã£ Ä‘Æ°á»£c tá»± Ä‘á»™ng táº¡o khi báº¡n Ä‘Äƒng kÃ½</li>
              <li>LiÃªn há»‡ admin Ä‘á»ƒ Ä‘Æ°á»£c cung cáº¥p mÃ£ cá»§a báº¡n ZALO: 0982443113</li>

            </ol>
          </div>
          <div
            style="
              background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
              padding: 15px;
              border-radius: 8px;
              margin-bottom: 20px;
              border-left: 4px solid #f59e0b;
            "
          >
            <p style="margin: 0; color: #92400e; font-size: 14px">
              âš ï¸ <strong>LÆ°u Ã½ quan trá»ng:</strong> Báº¡n cÃ³ tá»‘i Ä‘a
              <strong>3 láº§n</strong> nháº­p mÃ£. Nháº­p sai <strong>3 láº§n</strong> sáº½
              bá»‹
              <strong style="color: #dc2626">khÃ³a tÃ i khoáº£n vÄ©nh viá»…n</strong>!
            </p>
          </div>
          <form onsubmit="handleVerifyCode(event)">
            <div class="form-group">
              <label>Nháº­p mÃ£ truy cáº­p (16 kÃ½ tá»±)</label>
              <input
                type="text"
                id="accessCodeInput"
                required
                placeholder="XXXX-XXXX-XXXX-XXXX"
                maxlength="16"
                style="
                  font-size: 18px;
                  letter-spacing: 3px;
                  text-transform: uppercase;
                  font-family: 'Courier New', monospace;
                  text-align: center;
                "
              />
              <small
                class="help-text"
                style="display: block; margin-top: 8px; color: #6b7280"
              >
                Nháº­p mÃ£ 16 kÃ½ tá»± mÃ  admin Ä‘Ã£ cung cáº¥p cho báº¡n
              </small>
            </div>
            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%; font-size: 16px"
            >
              ğŸ”“ XÃ¡c Thá»±c Ngay
            </button>
          </form>
        </div>

        <!-- Admin Accounts Section -->
        <div id="accountsSection" class="card" style="display: none">
          <div class="card-header">
            <h3>ğŸ“§ Quáº£n LÃ½ Admin Accounts</h3>
            <div style="display: flex; gap: 10px; align-items: center">
              <button onclick="showAddAccountModal()" class="btn btn-success">
                â• ThÃªm Account
              </button>
              <!-- <button onclick="sendInvitesToAll()" class="btn btn-primary">
                ğŸ“§ Gá»­i Invite Táº¥t Cáº£
              </button>
              <button
                onclick="autoCleanupAll()"
                class="btn btn-danger"
                style="
                  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                "
              >
                ğŸ§¹ XÃ³a Members KhÃ´ng Há»£p Lá»‡
              </button>
              <button
                onclick="cleanupAllPendingInvites()"
                class="btn btn-danger"
                style="
                  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                "
              >
                ğŸ§¹ Cleanup Pending Invites
              </button> -->
              <div class="countdown-display">
                <span style="font-size: 14px; color: #666">Next check: </span>
                <span
                  id="countdownTimer"
                  style="font-size: 18px; font-weight: bold; color: #2563eb"
                  >30s</span
                >
              </div>
            </div>
          </div>

          <!-- Real-time Stats -->
          <div class="stats-row">
            <div class="stat-box">
              <div class="stat-label">ğŸ“Š Total Accounts</div>
              <div class="stat-value">
                <span id="totalAccountsCount">0</span>
                <span id="filteredAccountsCount" style="font-size: 12px; color: #9ca3af; margin-left: 4px;"></span>
              </div>
            </div>
            <div class="stat-box">
              <div class="stat-label">ğŸ‘¥ Total Members</div>
              <div class="stat-value" id="totalMembersCount">0</div>
            </div>
            <div class="stat-box">
              <div class="stat-label">âœ… Success</div>
              <div class="stat-value" id="successAccountsCount">0</div>
            </div>
            <div class="stat-box">
              <div class="stat-label">âŒ Failed</div>
              <div class="stat-value" id="failedAccountsCount">0</div>
            </div>
          </div>

          <!-- Search & Sort Controls -->
          <div style="display: flex; gap: 12px; margin-bottom: 16px; align-items: center; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 250px;">
              <input 
                type="text" 
                id="searchInput" 
                placeholder="ğŸ” TÃ¬m kiáº¿m theo tÃªn, email, hoáº·c Account ID..."
                onkeyup="handleSearch(this.value)"
                style="width: 100%; padding: 10px 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: border-color 0.3s;"
                onfocus="this.style.borderColor='#3b82f6'"
                onblur="this.style.borderColor='#e5e7eb'"
              />
            </div>
            <div>
              <select 
                id="sortSelect" 
                onchange="handleSortFromDropdown(this.value)"
                style="padding: 10px 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                <option value="createdAt_desc">ğŸ†• Má»›i nháº¥t</option>
                <option value="createdAt_asc">ğŸ“… CÅ© nháº¥t</option>
                <option value="name_asc">ğŸ”¤ TÃªn A-Z</option>
                <option value="name_desc">ğŸ”¤ TÃªn Z-A</option>
              </select>
            </div>
          </div>

          <!-- Date Filter Controls -->
          <div style="display: flex; gap: 12px; margin-bottom: 16px; align-items: center; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 12px; border-radius: 8px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="color: #e2e8f0; font-size: 14px; font-weight: 500;">ğŸ“… Lá»c theo:</label>
              <select 
                id="dateFieldSelect"
                onchange="handleDateFilterChange()"
                style="padding: 8px 12px; border: 2px solid #334155; border-radius: 6px; font-size: 13px; background: #0f172a; color: #e2e8f0; cursor: pointer;">
                <option value="createdAt">NgÃ y táº¡o</option>
                <option value="updatedAt">NgÃ y cáº­p nháº­t</option>
              </select>
            </div>
            
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="color: #e2e8f0; font-size: 14px;">Tá»«:</label>
              <input 
                type="date" 
                id="dateFromInput"
                onchange="handleDateFilterChange()"
                style="padding: 8px 12px; border: 2px solid #334155; border-radius: 6px; font-size: 13px; background: #0f172a; color: #e2e8f0; cursor: pointer;"
              />
            </div>
            
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="color: #e2e8f0; font-size: 14px;">Äáº¿n:</label>
              <input 
                type="date" 
                id="dateToInput"
                onchange="handleDateFilterChange()"
                style="padding: 8px 12px; border: 2px solid #334155; border-radius: 6px; font-size: 13px; background: #0f172a; color: #e2e8f0; cursor: pointer;"
              />
            </div>
            
            <button 
              onclick="clearDateFilter()"
              style="padding: 8px 16px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 500; transition: all 0.3s;"
              onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(239, 68, 68, 0.4)'"
              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
              ğŸ—‘ï¸ XÃ³a bá»™ lá»c
            </button>
            
            <div id="dateFilterInfo" style="color: #9ca3af; font-size: 12px; font-style: italic; margin-left: auto;"></div>
          </div>

          <!-- Accounts Table -->
          <div class="table-container">
            <table class="accounts-table">
              <thead>
                <tr>
                  <th style="width: 50px">#</th>
                  <th style="width: 180px">Account Name</th>
                  <th style="width: 100px">
                    <div style="text-align: center">Members</div>
                    <div
                      style="
                        font-size: 10px;
                        font-weight: normal;
                        color: #9ca3af;
                        margin-top: 2px;
                      "
                    >
                      User/Max (Tá»•ng/8)
                    </div>
                  </th>
                  <th style="width: 220px">Member Emails</th>
                  <th style="width: 180px">Member Cá»‘ Äá»‹nh</th>
                  <th style="width: 90px">Pending Invites</th>
                  <th style="width: 140px">Dates</th>
                  <th style="width: 100px">Next Check</th>
                  <th style="width: 120px">Status</th>
                  <th style="width: 200px">Actions</th>
                </tr>
              </thead>
              <tbody id="accountsTableBody">
                <tr>
                  <td colspan="10" class="loading-cell">Äang táº£i dá»¯ liá»‡u...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination Controls -->
          <div id="paginationControls" style="margin-top: 16px;"></div>

        </div>
      </div>
    </div>

    <!-- Add Account Modal -->
    <div id="addAccountModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>â• ThÃªm Admin Account</h3>
          <button onclick="closeAddAccountModal()" class="btn-close">
            &times;
          </button>
        </div>
        <form onsubmit="handleAddAccount(event)">
          <div class="form-group">
            <label>TÃªn Account (Äá»ƒ nháº­n diá»‡n)</label>
            <input
              type="text"
              id="newAccountName"
              placeholder="VD: Account ChÃ­nh, Account Test, ..."
            />
            <small class="help-text"
              >Äáº·t tÃªn cho account Ä‘á»ƒ dá»… quáº£n lÃ½. Äá»ƒ trá»‘ng sáº½ máº·c Ä‘á»‹nh lÃ 
              "Unnamed Account"</small
            >
          </div>
          <div class="form-group">
            <label>Email Admin</label>
            <input
              type="email"
              id="newAccountEmail"
              required
              placeholder="admin@example.com"
            />
            <small class="help-text">Email cá»§a ChatGPT admin account</small>
          </div>
          <div class="form-group">
            <label>Access Token</label>
            <textarea
              id="newAccessToken"
              required
              placeholder="eyJhbGc..."
              rows="4"
            ></textarea>
            <small class="help-text"
              >Bearer token tá»« ChatGPT (copy toÃ n bá»™ token, khÃ´ng cáº§n "Bearer "
              prefix)</small
            >
          </div>
          <div class="form-group">
            <label>Account ID (TÃ¹y chá»n)</label>
            <input
              type="text"
              id="newAccountId"
              placeholder="17dc4860-eff7-434e-bada-9a09fbdbac88 (UUID format)"
            />
            <small class="help-text"
              >Äá»ƒ trá»‘ng - há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng láº¥y. Náº¿u muá»‘n nháº­p: láº¥y tá»« URL
              /accounts/{UUID}/users</small
            >
          </div>
          <div class="form-group">
            <label>Member Cá»‘ Äá»‹nh (Email Ä‘Æ°á»£c phÃ©p)</label>
            <textarea
              id="newAllowedMembers"
              placeholder="member1@gmail.com&#10;member2@gmail.com&#10;member3@gmail.com"
              rows="4"
            ></textarea>
            <small class="help-text"
              >Má»—i email má»™t dÃ²ng. Email admin sáº½ tá»± Ä‘á»™ng Ä‘Æ°á»£c bá» qua (khÃ´ng cáº§n
              nháº­p)</small
            >
          </div>
          <div class="form-group">
            <label>Sá»‘ LÆ°á»£ng Members Tá»‘i Äa</label>
            <input
              type="number"
              id="newMaxMembers"
              placeholder="7"
              min="1"
              max="100"
              value="7"
            />
            <small class="help-text"
              >Giá»›i háº¡n sá»‘ lÆ°á»£ng members (khÃ´ng tÃ­nh admin). Máº·c Ä‘á»‹nh: 7
              (ChatGPT Business limit)</small
            >
          </div>
          <div class="modal-footer">
            <button
              type="button"
              onclick="closeAddAccountModal()"
              class="btn btn-secondary"
            >
              Há»§y
            </button>
            <button type="submit" class="btn btn-primary">ThÃªm Account</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Allowed Members Modal -->
    <div id="editAllowedMembersModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>âœï¸ Chá»‰nh Sá»­a Member Cá»‘ Äá»‹nh</h3>
          <button onclick="closeEditAllowedMembersModal()" class="btn-close">
            &times;
          </button>
        </div>
        <form onsubmit="handleUpdateAllowedMembers(event)">
          <input type="hidden" id="editAccountId" />
          <div class="form-group">
            <label>Admin Email</label>
            <input
              type="text"
              id="editAdminEmail"
              readonly
              style="background: #1a1a1a; color: #9ca3af"
            />
          </div>
          <div class="form-group">
            <label>Member Cá»‘ Äá»‹nh (Email Ä‘Æ°á»£c phÃ©p)</label>
            <textarea
              id="editAllowedMembers"
              placeholder="member1@gmail.com&#10;member2@gmail.com&#10;member3@gmail.com"
              rows="6"
            ></textarea>
            <small class="help-text"
              >Má»—i email má»™t dÃ²ng. Email admin sáº½ tá»± Ä‘á»™ng Ä‘Æ°á»£c bá» qua (khÃ´ng cáº§n
              nháº­p)</small
            >
          </div>
          <div class="modal-footer">
            <button
              type="button"
              onclick="closeEditAllowedMembersModal()"
              class="btn btn-secondary"
            >
              Há»§y
            </button>
            <button type="submit" class="btn btn-primary">Cáº­p Nháº­t</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Send Invite Modal -->
    <div id="sendInviteModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ğŸ“§ Gá»­i Lá»i Má»i</h3>
          <button onclick="closeSendInviteModal()" class="btn-close">
            &times;
          </button>
        </div>
        <form onsubmit="handleSendInvite(event)">
          <input type="hidden" id="inviteAccountId" />
          <div class="form-group">
            <label>Admin Email</label>
            <input
              type="text"
              id="inviteAdminEmail"
              readonly
              style="background: #1a1a1a; color: #9ca3af"
            />
          </div>
          <div class="form-group">
            <label>Email Members</label>
            <textarea
              id="inviteEmails"
              placeholder="member1@gmail.com&#10;member2@gmail.com&#10;member3@gmail.com"
              rows="6"
            ></textarea>
            <small class="help-text"
              >Má»—i email má»™t dÃ²ng. Email sáº½ tá»± Ä‘á»™ng thÃªm vÃ o Member Cá»‘ Äá»‹nh.
              KhÃ´ng Ä‘Æ°á»£c trÃ¹ng vá»›i email Ä‘Ã£ cÃ³ á»Ÿ account khÃ¡c. Limit: 8 members
              total (1 admin + 7 user members).</small
            >
          </div>
          <div class="form-group" id="slotInfoContainer">
            <label>
              Slots cÃ²n láº¡i:
              <span
                id="remainingSlots"
                style="color: #10b981; font-weight: bold"
                >--</span
              >
              <span style="color: #9ca3af" id="slotDetails">(Äang táº£i...)</span>
            </label>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              onclick="closeSendInviteModal()"
              class="btn btn-secondary"
            >
              Há»§y
            </button>
            <button type="submit" class="btn btn-success">ğŸ“§ Gá»­i Invite</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="app.js"></script>
  </body>
</html>
